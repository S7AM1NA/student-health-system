# å­¦ç”Ÿå¥åº·ç®¡ç†ç³»ç»Ÿ - æ•°æ®åº“è¯¾ç¨‹è®¾è®¡

> åŒ—äº¬èˆªç©ºèˆªå¤©å¤§å­¦ 2025 æ•°æ®åº“è¯¾ç¨‹è®¾è®¡é¡¹ç›®

## ğŸ“Œ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Django + SQLite çš„å­¦ç”Ÿå¥åº·ç®¡ç†ç³»ç»Ÿï¼Œæ»¡è¶³æ•°æ®åº“è¯¾ç¨‹è®¾è®¡çš„å…¨éƒ¨è¦æ±‚ï¼š

| è¯¾ç¨‹è¦æ±‚ | å®Œæˆæƒ…å†µ |
| :--- | :---: |
| **14 ä¸ªå®ä½“** | âœ… 14/12-15 |
| **å­˜å‚¨è¿‡ç¨‹/è§¦å‘å™¨** | âœ… 4 ä¸ªè§¦å‘å™¨ |
| **å¤–æ¨¡å¼/è§†å›¾** | âœ… 2 ä¸ªè§†å›¾ |
| **3NF è§„èŒƒåŒ–** | âœ… å·²å®Œæˆ |
| **å‰ç«¯äº¤äº’ç•Œé¢** | âœ… 12 ä¸ªé¡µé¢ |
| **æ•°æ®å¯¼å…¥å¯¼å‡º** | âœ… Excel/CSV/JSON |

## ğŸ‘¥ å›¢é˜Ÿåˆ†å·¥

| æˆå‘˜ | è´Ÿè´£å†…å®¹ | å®ŒæˆçŠ¶æ€ |
| :--- | :--- | :---: |
| **æˆå‘˜ A** | æ•°æ®åº“æ¨¡å‹è®¾è®¡ã€è¿ç§»ã€è§¦å‘å™¨ã€è§†å›¾ã€API å¼€å‘ã€ç³»ç»Ÿæ—¥å¿— | âœ… 100% |
| **æˆå‘˜ B** | å‰ç«¯é¡µé¢å¼€å‘ã€ECharts æ•°æ®å¯è§†åŒ–ã€å¯¼å‡ºåŠŸèƒ½ | âœ… 100% |
| **æˆå‘˜ C** | æ•°æ®å¯¼å…¥å¯¼å‡ºæ¨¡å—ã€å¥åº·æ–‡ç« çˆ¬è™«/ç”Ÿæˆå™¨ | âœ… 100% |

## ğŸ—„ï¸ æ•°æ®åº“å®ä½“æ¸…å• (14ä¸ª)

| # | å®ä½“å | è¯´æ˜ |
| :---: | :--- | :--- |
| 1 | `CustomUser` | ç”¨æˆ·ä¿¡æ¯ |
| 2 | `SleepRecord` | ç¡çœ è®°å½• |
| 3 | `SportRecord` | è¿åŠ¨è®°å½• |
| 4 | `FoodItem` | é£Ÿç‰©åº“ |
| 5 | `Meal` | é¤æ¬¡ |
| 6 | `MealItem` | é¤å“æ¡ç›® |
| 7 | `UserHealthGoal` | å¥åº·ç›®æ ‡ |
| 8 | `Friendship` | å¥½å‹å…³ç³» |
| 9 | `Comment` | è¯„è®º |
| 10 | `SystemLog` | ç³»ç»Ÿæ—¥å¿— **[æ–°å¢]** |
| 11 | `BodyMetric` | èº«ä½“æŒ‡æ ‡ **[æ–°å¢]** |
| 12 | `ArticleCategory` | æ–‡ç« åˆ†ç±» **[æ–°å¢]** |
| 13 | `HealthArticle` | å¥åº·æ–‡ç«  **[æ–°å¢]** |
| 14 | `UserReadHistory` | é˜…è¯»å†å² **[æ–°å¢]** |

## âš™ï¸ SQL è§¦å‘å™¨ä¸è§†å›¾

### è§¦å‘å™¨ (4ä¸ª)
- `trg_calculate_sleep_duration` - è‡ªåŠ¨è®¡ç®—ç¡çœ æ—¶é•¿
- `trg_calculate_bmi` - è‡ªåŠ¨è®¡ç®— BMI
- `trg_calculate_meal_item_calories` - è‡ªåŠ¨è®¡ç®—é¤å“çƒ­é‡
- `trg_increment_article_views` - è‡ªåŠ¨å¢åŠ æ–‡ç« é˜…è¯»é‡

### è§†å›¾ (2ä¸ª)
- `v_user_daily_summary` - ç”¨æˆ·æ¯æ—¥å¥åº·æ‘˜è¦
- `v_user_health_data` - ç”¨æˆ·å®Œæ•´å¥åº·æ•°æ®èšåˆ

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

*   **åç«¯**: Django 5.2 + Django REST Framework
*   **æ•°æ®åº“**: SQLite (å¼€å‘) / MySQL (å¯åˆ‡æ¢)
*   **å‰ç«¯**: HTML5 + CSS3 + JavaScript + Bootstrap 5
*   **å›¾è¡¨**: ECharts / Chart.js
*   **ç‰ˆæœ¬æ§åˆ¶**: Git & GitHub

## ç¯å¢ƒé…ç½®ä¸å¯åŠ¨ 

1. **å…‹éš†ä»“åº“**

   ```bash
   git clone https://github.com/S7AM1NA/student-health-system.git
   cd student-health-system
   ```

2. **åˆ›å»ºå¹¶æ¿€æ´»Pythonè™šæ‹Ÿç¯å¢ƒ**
   ```bash
   # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
   python -m venv .venv
   
   # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
   # Windows (PowerShell):
   .\.venv\Scripts\activate
   # macOS / Linux:
   source .venv/bin/activate
   ```
   *æ¿€æ´»åï¼Œå‘½ä»¤è¡Œå‰ç«¯ä¼šå‡ºç° `(venv)` æ ‡è¯†ã€‚*

3. **å®‰è£…é¡¹ç›®ä¾èµ–**
   ```bash
   pip install -r requirements.txt
   ```

4. **åº”ç”¨æ•°æ®åº“è¿ç§»**
   æ­¤æ­¥éª¤ä¼šæ ¹æ®å·²æœ‰çš„æ¨¡å‹æ–‡ä»¶åœ¨æœ¬åœ°åˆ›å»º`db.sqlite3`æ•°æ®åº“æ–‡ä»¶ã€‚

   ```bash
   python manage.py migrate
   ```

5. **å¯¼å…¥å¼€æºè¥å…»åº“æ•°æ®**

   - **æ“ä½œè¦æ±‚ï¼š** åœ¨è¿è¡Œæ–°å‘½ä»¤å‰ï¼Œå»ºè®®å…ˆæ¸…ç©º `FoodItem` è¡¨ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚ç„¶å**è¿è¡Œå¯¼å…¥å‘½ä»¤**ã€‚

   ```bash
   # 1. (å¯é€‰ä½†æ¨è) è¿›å…¥Django Shellæ¸…ç©ºæ•°æ®
   # python manage.py shell
   # >>> from core.models import FoodItem
   # >>> FoodItem.objects.all().delete()
   # >>> exit()
   
   # 2. è¿è¡Œå¯¼å…¥å‘½ä»¤
   python manage.py import_food_data food_data_json
   ```

6. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

   ```bash
   python manage.py runserver
   ```
   ç°åœ¨ï¼Œä½ å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® `http://127.0.0.1:8000/` æ¥æŸ¥çœ‹é¡¹ç›®äº†ã€‚

7. **åˆ›å»ºæœ¬åœ°ç®¡ç†å‘˜è´¦å·**

   ```
   python manage.py createsuperuser
   ```


   ç°åœ¨ï¼Œå¯ä»¥è®¿é—® `http://127.0.0.1:8000/admin/` åå°ç®¡ç†ç•Œé¢æŸ¥çœ‹å’Œç®¡ç†æ•°æ®ã€‚

---

## æ•°æ®åº“æ¨¡å‹

ä»¥ä¸‹æ˜¯ç³»ç»Ÿæ‰€æœ‰æ•°æ®è¡¨çš„ç»“æ„è¯¦æƒ…ã€‚

1. **CustomUser (ç”¨æˆ·ä¿¡æ¯)**

| å­—æ®µå (Field)  | æ•°æ®ç±»å‹ (Type) | è¯´æ˜           | å¤‡æ³¨                     |
| :-------------- | :-------------- | :------------- | :----------------------- |
| `username`      | `CharField`     | ç”¨æˆ·å         | å¿…å¡«ï¼Œå”¯ä¸€               |
| `password`      | `CharField`     | å¯†ç ï¼ˆå·²åŠ å¯†ï¼‰ | Djangoè‡ªåŠ¨å¤„ç†           |
| `email`         | `EmailField`    | é‚®ç®±           | å¿…å¡«                     |
| `gender`        | `CharField`     | æ€§åˆ«           | å¯é€‰ã€‚'M' (ç”·), 'F' (å¥³) |
| `date_of_birth` | `DateField`     | å‡ºç”Ÿæ—¥æœŸ       | å¯é€‰                     |

2. **SleepRecord (ç¡çœ è®°å½•)**

| å­—æ®µå (Field) | æ•°æ®ç±»å‹ (Type) | è¯´æ˜     | å¤‡æ³¨                                  |
| :------------- | :-------------- | :------- | :------------------------------------ |
| `user`         | `ForeignKey`    | æ‰€å±ç”¨æˆ· | å…³è”åˆ°`CustomUser`                    |
| `sleep_time`   | `DateTimeField` | å…¥ç¡æ—¶é—´ | å‰ç«¯éœ€æä¾› `YYYY-MM-DDTHH:MM:SS` æ ¼å¼ |
| `wakeup_time`  | `DateTimeField` | èµ·åºŠæ—¶é—´ | å‰ç«¯éœ€æä¾› `YYYY-MM-DDTHH:MM:SS` æ ¼å¼ |
| `duration`     | `DurationField` | ç¡çœ æ—¶é•¿ | **åç«¯è‡ªåŠ¨è®¡ç®—**ï¼Œæ— éœ€å‰ç«¯æä¾›        |

3. **SportRecord (è¿åŠ¨è®°å½•)**

| å­—æ®µå (Field)     | æ•°æ®ç±»å‹ (Type)        | è¯´æ˜             | å¤‡æ³¨                                       |
| :----------------- | :--------------------- | :--------------- | :----------------------------------------- |
| `user`             | `ForeignKey`           | æ‰€å±ç”¨æˆ·         | å…³è”åˆ°`CustomUser`                         |
| `sport_type`       | `CharField`            | è¿åŠ¨ç±»å‹         | ä¾‹å¦‚ "è·‘æ­¥", "æ¸¸æ³³"                        |
| `duration_minutes` | `PositiveIntegerField` | è¿åŠ¨æ—¶é•¿(åˆ†é’Ÿ)   | æ•´æ•°                                       |
| `calories_burned`  | `FloatField`           | æ¶ˆè€—å¡è·¯é‡Œ(å¤§å¡) |                                            |
| `record_date`      | `DateField`            | è®°å½•æ—¥æœŸ         | **å‰ç«¯æä¾›**ã€‚å‰ç«¯é»˜è®¤ä¸ºå½“å¤©ï¼Œç”¨æˆ·å¯ä¿®æ”¹ã€‚ |

4. **FoodItem (é£Ÿç‰©åº“)**

| å­—æ®µå (Field)      | æ•°æ®ç±»å‹ (Type) | è¯´æ˜               | å¤‡æ³¨               |
| :------------------ | :-------------- | :----------------- | :----------------- |
| `name`              | `CharField`     | é£Ÿç‰©åç§°           | å”¯ä¸€               |
| `calories_per_100g` | `FloatField`    | æ¯100gå¡è·¯é‡Œ(å¤§å¡) | ç”±ç®¡ç†å‘˜åœ¨åå°å½•å…¥ |

5. **Meal (é¤æ¬¡) & MealItem (é¤å“æ¡ç›®)**
ä¸€æ¬¡é¥®é£Ÿè®°å½•åˆ†ä¸º "**ä¸€é¤(Meal)**" å’Œ "**é¤é‡Œçš„é£Ÿç‰©(MealItem)**" ä¸¤éƒ¨åˆ†ã€‚

- **Meal (é¤æ¬¡)**

| å­—æ®µå (Field)   | æ•°æ®ç±»å‹ (Type) | è¯´æ˜       | å¤‡æ³¨                                       |
| :--------------- | :-------------- | :--------- | :----------------------------------------- |
| `user`           | `ForeignKey`    | æ‰€å±ç”¨æˆ·   | å…³è”åˆ°`CustomUser`                         |
| `meal_type`      | `CharField`     | é¤æ¬¡ç±»å‹   | 'breakfast', 'lunch', 'dinner', 'snack'    |
| `record_date`    | `DateField`     | è®°å½•æ—¥æœŸ   | **å‰ç«¯æä¾›**ã€‚å‰ç«¯é»˜è®¤ä¸ºå½“å¤©ï¼Œç”¨æˆ·å¯ä¿®æ”¹ã€‚ |
| `total_calories` | `property`      | è¯¥é¤æ€»çƒ­é‡ | **åç«¯è‡ªåŠ¨è®¡ç®—**                           |

- **MealItem (é¤å“æ¡ç›®)**

| å­—æ®µå (Field)        | æ•°æ®ç±»å‹ (Type) | è¯´æ˜       | å¤‡æ³¨                             |
| :-------------------- | :-------------- | :--------- | :------------------------------- |
| `meal`                | `ForeignKey`    | æ‰€å±é¤æ¬¡   | å…³è”åˆ°`Meal`                     |
| `food_item`           | `ForeignKey`    | é£Ÿç‰©æ¡ç›®   | å…³è”åˆ°`FoodItem`ï¼Œç”¨æˆ·ä»åº“ä¸­é€‰æ‹© |
| `portion`             | `FloatField`    | ä»½é‡(å…‹)   | ç”¨æˆ·è¾“å…¥                         |
| `calories_calculated` | `FloatField`    | è®¡ç®—å¡è·¯é‡Œ | **åç«¯è‡ªåŠ¨è®¡ç®—**                 |

6. **UserHealthGoal (ç”¨æˆ·å¥åº·ç›®æ ‡)**

| å­—æ®µå (Field)                  | æ•°æ®ç±»å‹ (Type)        | è¯´æ˜                   | å¤‡æ³¨                             |
| ------------------------------- | ---------------------- | ---------------------- | -------------------------------- |
| `user`                          | `OneToOneField`        | æ‰€å±ç”¨æˆ·               | å…³è”åˆ°`CustomUser`ï¼Œæ¯ä¸ªç”¨æˆ·å”¯ä¸€ |
| `target_sleep_duration`         | `FloatField`           | ç›®æ ‡ç¡çœ æ—¶é•¿(å°æ—¶)     |                                  |
| `target_sport_duration_minutes` | `PositiveIntegerField` | ç›®æ ‡è¿åŠ¨æ—¶é•¿(åˆ†é’Ÿ)     |                                  |
| `target_sport_calories`         | `PositiveIntegerField` | ç›®æ ‡è¿åŠ¨æ¶ˆè€—çƒ­é‡(å¤§å¡) |                                  |
| `target_diet_calories`          | `PositiveIntegerField` | ç›®æ ‡é¥®é£Ÿæ‘„å…¥çƒ­é‡(å¤§å¡) |                                  |

7.  **Friendship (å¥½å‹å…³ç³»)**
    æ­¤è¡¨ç”¨äºè®°å½•ç”¨æˆ·ä¹‹é—´çš„å¥½å‹å…³ç³»çŠ¶æ€å’ŒåŒå‘çš„åŠ¨æ€æŸ¥çœ‹æˆæƒã€‚

| å­—æ®µå (Field)            | æ•°æ®ç±»å‹ (Type) | è¯´æ˜                   | å¤‡æ³¨                                                         |
| :------------------------ | :-------------- | :--------------------- | :----------------------------------------------------------- |
| `from_user`               | `ForeignKey`    | è¯·æ±‚å‘èµ·è€…             | å…³è”åˆ°`CustomUser`                                           |
| `to_user`                 | `ForeignKey`    | è¯·æ±‚æ¥æ”¶è€…             | å…³è”åˆ°`CustomUser`                                           |
| `status`                  | `CharField`     | å…³ç³»çŠ¶æ€               | 'pending' (å¾…å¤„ç†), 'accepted' (å·²æ¥å—), 'rejected' (å·²æ‹’ç») |
| `created_at`              | `DateTimeField` | åˆ›å»ºæ—¶é—´               | **åç«¯è‡ªåŠ¨ç”Ÿæˆ**                                             |
| `from_user_can_be_viewed` | `BooleanField`  | å‘èµ·è€…åŠ¨æ€æ˜¯å¦å¯è¢«æŸ¥çœ‹ | `from_user` å¯¹ `to_user` çš„æˆæƒï¼Œé»˜è®¤ä¸º `true`               |
| `to_user_can_be_viewed`   | `BooleanField`  | æ¥æ”¶è€…åŠ¨æ€æ˜¯å¦å¯è¢«æŸ¥çœ‹ | `to_user` å¯¹ `from_user` çš„æˆæƒï¼Œé»˜è®¤ä¸º `true`               |

8.  **Comment (è¯„è®º)**
    è¿™æ˜¯ä¸€ä¸ª**é€šç”¨è¯„è®ºè¡¨**ï¼Œå¯ä»¥å…³è”åˆ°ä»»ä½•å¯è¢«è¯„è®ºçš„åŠ¨æ€è®°å½•ä¸Šï¼ˆå¦‚ç¡çœ ã€è¿åŠ¨ã€é¥®é£Ÿç­‰ï¼‰ã€‚

| å­—æ®µå (Field) | æ•°æ®ç±»å‹ (Type)        | è¯´æ˜         | å¤‡æ³¨                                                         |
| :------------- | :--------------------- | :----------- | :----------------------------------------------------------- |
| `user`         | `ForeignKey`           | è¯„è®ºä½œè€…     | å…³è”åˆ°`CustomUser`                                           |
| `text`         | `TextField`            | è¯„è®ºå†…å®¹     |                                                              |
| `created_at`   | `DateTimeField`        | è¯„è®ºæ—¶é—´     | **åç«¯è‡ªåŠ¨ç”Ÿæˆ**                                             |
| `content_type` | `ForeignKey`           | å…³è”å¯¹è±¡ç±»å‹ | æŒ‡å‘ `ContentType` è¡¨ï¼Œç”¨äºæ ‡è¯†è¢«è¯„è®ºçš„æ˜¯å“ªç§è®°å½• (ä¾‹å¦‚ `SleepRecord`) |
| `object_id`    | `PositiveIntegerField` | å…³è”å¯¹è±¡ID   | å­˜å‚¨è¢«è¯„è®ºè®°å½•çš„ä¸»é”® ID (ä¾‹å¦‚ `SleepRecord` çš„ ID)           |

---

##  APIæ¥å£æ–‡æ¡£

ä»¥ä¸‹æ˜¯å½“å‰å¯ç”¨çš„åç«¯APIæ¥å£ï¼Œä¸»è¦ä¾›å‰ç«¯å¼€å‘äººå‘˜ä½¿ç”¨ã€‚æ‰€æœ‰æ¥å£éƒ½æš‚æ—¶å…³é—­äº†CSRFä¿æŠ¤ï¼Œæ–¹ä¾¿ç›´æ¥è°ƒç”¨ã€‚

**é™¤æ³¨å†Œå’Œç™»å½•æ¥å£å¤–ï¼Œä»¥ä¸‹æ‰€æœ‰APIéƒ½éœ€è¦ç”¨æˆ·å¤„äºç™»å½•çŠ¶æ€æ‰èƒ½è®¿é—®ã€‚**

### 1. ç”¨æˆ·æ³¨å†Œ

*   **URL**: `/api/register/`
*   **Method**: `POST`
*   **Request Body** (JSON):
    ```json
    {
        "username": "your_username",
        "password": "your_password",
        "email": "your_email@example.com"
    }
    ```
*   **Success Response** (`201 Created`):
    ```json
    {
        "status": "success",
        "message": "ç”¨æˆ·æ³¨å†ŒæˆåŠŸ"
    }
    ```
*   **Error Response** (`400 Bad Request`):
    ```json
    {
        "status": "error",
        "message": "ç”¨æˆ·åå·²å­˜åœ¨" // æˆ–å…¶ä»–é”™è¯¯ä¿¡æ¯
    }
    ```

### 2. ç”¨æˆ·ç™»å½•

*   **URL**: `/api/login/`
*   **Method**: `POST`
*   **Request Body** (JSON):
    ```json
    {
        "username": "your_username",
        "password": "your_password"
    }
    ```
*   **Success Response** (`200 OK`):
    ```json
    {
        "status": "success",
        "message": "ç™»å½•æˆåŠŸ",
        "user_id": 1,
        "username": "your_username"
    }
    ```

### 3. ç”¨æˆ·æ³¨é”€

*   **URL**: `/api/logout/`
*   **Method**: `POST`
*   **Request Body**: (Empty)
*   **Success Response** (`200 OK`):
    ```json
    {
        "status": "success",
        "message": "å·²æˆåŠŸæ³¨é”€"
    }
    ```
    
### **4. ç”¨æˆ·ä¸ªäººæ¡£æ¡ˆ (Profile)**

*   **Endpoint**: `/api/profile/`
*   **æ ¸å¿ƒ**: ç®¡ç†å½“å‰ç™»å½•ç”¨æˆ·çš„ä¸ªäººè¯¦ç»†ä¿¡æ¯ã€‚

| æ“ä½œ             | Method | URL             | è¯´æ˜                     |
| :--------------- | :----- | :-------------- | :----------------------- |
| **è·å–ä¸ªäººæ¡£æ¡ˆ** | `GET`  | `/api/profile/` | è·å–å½“å‰ç”¨æˆ·çš„è¯¦ç»†æ¡£æ¡ˆã€‚ |
| **æ›´æ–°ä¸ªäººæ¡£æ¡ˆ** | `PUT`  | `/api/profile/` | æ›´æ–°å½“å‰ç”¨æˆ·çš„æ¡£æ¡ˆä¿¡æ¯ã€‚ |

* **æ›´æ–° (PUT) Request Body**: (åªéœ€æä¾›éœ€è¦ä¿®æ”¹çš„å­—æ®µ)

  ```json
  {
      "email": "new_email@example.com",
      "gender": "F",
      "date_of_birth": "2001-05-20"
  }
  ```

* **å“åº” (GET/PUT) Body**:

  ```json
  {
      "username": "your_username",
      "email": "new_email@example.com",
      "gender": "F",
      "date_of_birth": "2001-05-20"
  }
  ```

### **5. ç”¨æˆ·å¥åº·ç›®æ ‡ (Health Goals)**

- **Endpoint**: /api/goals/
- **æ ¸å¿ƒ**: ç®¡ç†å½“å‰ç™»å½•ç”¨æˆ·çš„ä¸ªäººæ¯æ—¥å¥åº·ç›®æ ‡ã€‚å¦‚æœç”¨æˆ·æ²¡æœ‰ç›®æ ‡ï¼Œç³»ç»Ÿä¼šåœ¨é¦–æ¬¡è®¿é—®æ—¶è‡ªåŠ¨åˆ›å»ºã€‚

| æ“ä½œ              | Method | URL         | è¯´æ˜                                   |
| ----------------- | ------ | ----------- | -------------------------------------- |
| **è·å–å¥åº·ç›®æ ‡**  | GET    | /api/goals/ | è·å–å½“å‰ç”¨æˆ·çš„å¥åº·ç›®æ ‡ã€‚               |
| **åˆ›å»º/æ›´æ–°ç›®æ ‡** | PUT    | /api/goals/ | åˆ›å»ºæˆ–æ›´æ–°ç”¨æˆ·çš„ç›®æ ‡ï¼ˆæ”¯æŒéƒ¨åˆ†æ›´æ–°ï¼‰ã€‚ |

- **æ›´æ–° (PUT) Request Body**: (åªéœ€æä¾›éœ€è¦ä¿®æ”¹çš„å­—æ®µ)

  ```json
  {
      "target_sleep_duration": 8,
      "target_sport_calories": 300
  }
  ```

- **å“åº” (GET/PUT) Body**:

  ```json
  {
      "id": 1,
      "target_sleep_duration": 8.0,
      "target_sport_duration_minutes": 60,
      "target_sport_calories": 300,
      "target_diet_calories": 2000
  }
  ```

### **6. ç¡çœ è®°å½• (Sleep Records)**

*   **Endpoint**: `/api/sleep/`
*   **æ ¸å¿ƒ**: ç®¡ç†å½“å‰ç™»å½•ç”¨æˆ·çš„ç¡çœ è®°å½•ã€‚

| æ“ä½œ             | Method        | URL                       | è¯´æ˜                               |
| :--------------- | :------------ | :------------------------ | :--------------------------------- |
| **è·å–åˆ—è¡¨**     | `GET`         | `/api/sleep/`             | è·å–è¯¥ç”¨æˆ·çš„æ‰€æœ‰ç¡çœ è®°å½•ã€‚         |
| **æ£€æŸ¥ä»Šæ—¥è®°å½•** | `GET`         | `/api/sleep/today-check/` | è½»é‡çº§æ¥å£ï¼Œæ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²æœ‰è®°å½•ã€‚ |
| **åˆ›å»ºæ–°è®°å½•**   | `POST`        | `/api/sleep/`             | æ–°å¢ä¸€æ¡ç¡çœ è®°å½•ã€‚                 |
| **è·å–å•æ¡è¯¦æƒ…** | `GET`         | `/api/sleep/{id}/`        | æŸ¥çœ‹æŸæ¡å…·ä½“è®°å½•çš„è¯¦æƒ…ã€‚           |
| **æ›´æ–°è®°å½•**     | `PUT`/`PATCH` | `/api/sleep/{id}/`        | æ›´æ–°æŸæ¡è®°å½•ã€‚                     |
| **åˆ é™¤è®°å½•**     | `DELETE`      | `/api/sleep/{id}/`        | åˆ é™¤æŸæ¡è®°å½•ã€‚                     |

*   **ç­›é€‰åŠŸèƒ½**:
    
    *   æ­¤åˆ—è¡¨æ¥å£æ”¯æŒæŒ‰**èµ·åºŠæ—¥æœŸ**ç­›é€‰: `GET /api/sleep/?record_date=2025-07-31`
*   **åˆ›å»º (POST) Request Body**:
    
    ```json
    {
        "sleep_time": "2025-07-29T23:00:00",
        "wakeup_time": "2025-07-30T07:30:00"
    }
    ```
*   **å“åº” (GET/POST/PUT/PATCH) Body**:
    
    ```json
    {
        "id": 1,
        "sleep_time": "2025-07-29T23:00:00Z",
        "wakeup_time": "2025-07-30T07:30:00Z",
        "duration": "08:30:00"
    }
    ```

### **7. è¿åŠ¨è®°å½• (Sport Records)**

*   **Endpoint**: `/api/sports/`
*   **æ ¸å¿ƒ**: ç®¡ç†ç”¨æˆ·çš„è¿åŠ¨è®°å½•ã€‚æ¥å£ç»“æ„ä¸ç¡çœ è®°å½•ç›¸åŒã€‚

| æ“ä½œ             | Method        | URL                        | è¯´æ˜                       |
| :--------------- | :------------ | :------------------------- | :------------------------- |
| **è·å–åˆ—è¡¨**     | `GET`         | `/api/sports/`             | è·å–è¯¥ç”¨æˆ·çš„æ‰€æœ‰è¿åŠ¨è®°å½•ã€‚ |
| **æ£€æŸ¥ä»Šæ—¥è®°å½•** | `GET`         | `/api/sports/today-check/` | æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²æœ‰è¿åŠ¨è®°å½•ã€‚ |
| **åˆ›å»ºæ–°è®°å½•**   | `POST`        | `/api/sports/`             | æ–°å¢ä¸€æ¡è¿åŠ¨è®°å½•ã€‚         |
| **è·å–å•æ¡è¯¦æƒ…** | `GET`         | `/api/sports/{id}/`        | æŸ¥çœ‹æŸæ¡å…·ä½“è®°å½•çš„è¯¦æƒ…ã€‚   |
| **æ›´æ–°è®°å½•**     | `PUT`/`PATCH` | `/api/sports/{id}/`        | æ›´æ–°æŸæ¡è®°å½•ã€‚             |
| **åˆ é™¤è®°å½•**     | `DELETE`      | `/api/sports/{id}/`        | åˆ é™¤æŸæ¡è®°å½•ã€‚             |

* **ç­›é€‰åŠŸèƒ½**:

  *   æ­¤åˆ—è¡¨æ¥å£æ”¯æŒæŒ‰**è®°å½•æ—¥æœŸ**ç­›é€‰: `GET /api/sports/?record_date=2025-07-31`

* **æ£€æŸ¥ä»Šæ—¥è®°å½• (GET `/today-check/`) å“åº”**:

  ```json
  { "record_exists": true, "record_id": 45 }
  ```

* **åˆ›å»º (POST) Request Body**:

  ```json
  {
      "sport_type": "è·‘æ­¥",
      "duration_minutes": 30,
      "calories_burned": 250.5,
      "record_date": "2025-07-28"
  }
  ```

* **å“åº” Body**:

  ```json
  {
      "id": 1,
      "sport_type": "è·‘æ­¥",
      "duration_minutes": 30,
      "calories_burned": 250.5,
      "record_date": "2025-07-28"
  }
  ```

### **8. é£Ÿç‰©åº“ (Food Items)**

*   **Endpoint**: `/api/foods/`
*   **æ ¸å¿ƒ**: **åªè¯»æ¥å£**ï¼Œç”¨äºæœç´¢å’Œå±•ç¤ºé£Ÿç‰©åº“ä¿¡æ¯ã€‚

| æ“ä½œ             | Method | URL                | è¯´æ˜                       |
| :--------------- | :----- | :----------------- | :------------------------- |
| **è·å–åˆ—è¡¨**     | `GET`  | `/api/foods/`      | è·å–é£Ÿç‰©åº“åˆ—è¡¨ï¼Œæ”¯æŒæœç´¢ã€‚ |
| **è·å–å•æ¡è¯¦æƒ…** | `GET`  | `/api/foods/{id}/` | æŸ¥çœ‹æŸä¸ªé£Ÿç‰©çš„è¯¦ç»†ä¿¡æ¯ã€‚   |

*   **å“åº” Body**:
    ```json
    {
        "id": 101,
        "name": "è‹¹æœ",
        "calories_per_100g": 52.0
    }
    ```

### **9. é¥®é£Ÿè®°å½• (Meals & Meal Items)**

#### **9.1 é¤æ¬¡ (Meal)**

*   **Endpoint**: `/api/meals/`
*   **æ ¸å¿ƒ**: ç®¡ç†ä¸€é¤çš„æ•´ä½“ä¿¡æ¯ï¼Œå¦‚â€œæ—©é¤â€ã€â€œåˆé¤â€ã€‚

| æ“ä½œ             | Method | URL                       | è¯´æ˜                                       |
| :--------------- | :----- | :------------------------ | :----------------------------------------- |
| **è·å–åˆ—è¡¨**     | `GET`  | `/api/meals/`             | è·å–è¯¥ç”¨æˆ·çš„æ‰€æœ‰é¤æ¬¡è®°å½•ã€‚                 |
| **æ£€æŸ¥ä»Šæ—¥è®°å½•** | `GET`  | `/api/meals/today-check/` | æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²æœ‰ä»»ä½•é¤æ¬¡è®°å½•ã€‚             |
| **åˆ›å»ºæ–°è®°å½•**   | `POST` | `/api/meals/`             | æ–°å¢ä¸€æ¡é¤æ¬¡è®°å½•ã€‚                         |
| ...              | ...    | `/api/meals/{id}/`        | å…¶ä»– `GET`/`PUT`/`DELETE` æ“ä½œä¸ä¹‹å‰ç›¸åŒã€‚ |

* **ç­›é€‰åŠŸèƒ½**:

  æ­¤åˆ—è¡¨æ¥å£æ”¯æŒé€šè¿‡ URL æŸ¥è¯¢å‚æ•°è¿›è¡Œçµæ´»çš„ç­›é€‰ï¼š

  * **æŒ‰è®°å½•æ—¥æœŸ (`record_date`) ç­›é€‰**ï¼Œè·å–æŒ‡å®šæ—¥æœŸçš„æ‰€æœ‰é¤æ¬¡è®°å½•ï¼š

    ```
    GET /api/meals/?record_date=2025-07-31
    ```

  * **æŒ‰é¤æ¬¡ç±»å‹ (`meal_type`) ç­›é€‰**ï¼Œè·å–æ‰€æœ‰æŒ‡å®šç±»å‹çš„é¤æ¬¡è®°å½•ï¼ˆä¾‹å¦‚ï¼Œæ‰€æœ‰åˆé¤ï¼‰ï¼š

    ```
    GET /api/meals/?meal_type=lunch
    ```

  * **ç»„åˆç­›é€‰**ï¼ŒåŒæ—¶æŒ‰æ—¥æœŸå’Œé¤æ¬¡ç±»å‹è¿›è¡Œç²¾ç¡®æŸ¥æ‰¾ï¼š

    ```
    GET /api/meals/?record_date=2025-07-31&meal_type=lunch
    ```

  

* **æ£€æŸ¥ä»Šæ—¥è®°å½• (GET `/today-check/`) å“åº”**:

  ```json
  { "record_exists": true, "record_id": 25 }
  ```

* **åˆ›å»º (POST) Request Body**:

  ```json
  {
      "meal_type": "breakfast", // 'breakfast', 'lunch', 'dinner', 'snack'
      "record_date": "2025-07-28"
  }
  ```

* **è·å–åˆ—è¡¨/è¯¦æƒ… (GET) å“åº” Body**:

  ```json
  {
      "id": 25,
      "user": 1,
      "meal_type": "breakfast",
      "record_date": "2025-07-28",
      "total_calories": 354.0,
      "meal_items": [
          {
              "id": 50,
              "meal": 25,
              "food_item": 101,
              "food_item_name": "è‹¹æœ",
              "portion": 150.0,
              "calories_calculated": 78.0
          }
      ]
  }
  ```

#### **9.2 é¤å“æ¡ç›® (MealItem)**

*   **Endpoint**: `/api/meal-items/`
*   **æ ¸å¿ƒ**: å‘ä¸€ä¸ª**å·²å­˜åœ¨**çš„é¤æ¬¡ä¸­æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤å…·ä½“çš„é£Ÿç‰©æ¡ç›®ã€‚

*   **åˆ›å»º (POST) Request Body**:
    ```json
    {
        "meal": 25, // å¿…é¡»æä¾›æ‰€å±é¤æ¬¡çš„ID
        "food_item": 102, // å¿…é¡»æä¾›é£Ÿç‰©åº“ä¸­é£Ÿç‰©çš„ID
        "portion": 250.0 // ä»½é‡ï¼ˆå…‹ï¼‰
    }
    ```
*   **å“åº” Body**:
    ```json
    {
        "id": 51,
        "meal": 25,
        "food_item": 102,
        "food_item_name": "ç‰›å¥¶",
        "portion": 250.0,
        "calories_calculated": 276.0
    }
    ```

### **10. æ¯æ—¥å¥åº·çœ‹æ¿ (Dashboard)**

*   **URL**: `/api/dashboard/{date_str}/`
*   **Method**: `GET`
*   **URL å‚æ•°**: `date_str` - å¿…éœ€ã€‚æ ¼å¼ä¸º `YYYY-MM-DD` çš„æ—¥æœŸå­—ç¬¦ä¸²ã€‚
*   **æ ¸å¿ƒ**: è·å–æŒ‡å®šæ—¥æœŸçš„ç»¼åˆå¥åº·æ•°æ®çœ‹æ¿ã€‚
*   **Success Response (`200 OK`)**:
    ```json
    {
        "status": "success",
        "message": "2025-07-28 çš„å¥åº·æ•°æ®è·å–æˆåŠŸ",
        "user": { "username": "your_username", "user_id": 1 },
        "data": {
            "date": "2025-07-28",
            "sleep": {
                    "duration_hours": 6.47,
                    "sleep_time": "2025-07-28T00:32:00",
                    "wakeup_time": "2025-07-28T07:10:00",
                    "record_exists": true
            },
            "sports": {
                "total_calories_burned": 250.5,
                "total_duration_minutes": 30,
                "count": 1,
                "record_exists": true
            },
            "diet": {
                "total_calories_eaten": 2100.0,
                "record_exists": true
            },
            "goals": {
                "target_sleep_duration": 8.0,
                "progress_sleep_duration": 81,
                "target_sport_duration_minutes": 45,
                "progress_sport_duration": 67,
                "target_sport_calories": 300,
                "progress_sport_calories": 84,
                "target_diet_calories": 2200,
                "progress_diet_calories": 95
            },
            "health_summary": {
                "suggestion": "ä»Šå¤©æ‘„å…¥çš„çƒ­é‡æœ‰ç‚¹å¤šå“¦ï¼Œæ³¨æ„æ§åˆ¶é¥®é£Ÿï¼",
                "status_code": "HIGH_INTAKE"
            }
        }
    }
    ```
    
### **11. å‘¨åº¦ç¡çœ æ•°æ®æŠ¥å‘Š (Weekly Sleep Report)**

*   **URL**: `/api/reports/weekly-sleep/{end_date_str}/`
*   **Method**: `GET`
*   **Authentication**: éœ€è¦ (Authentication Required)
*   **URL å‚æ•°**:
    *   `end_date_str` - **å¿…éœ€**ã€‚æŠ¥å‘Šå‘¨æœŸçš„ç»“æŸæ—¥æœŸï¼Œæ ¼å¼ä¸º `YYYY-MM-DD`ã€‚APIå°†è¿”å›æ­¤æ—¥æœŸï¼ˆå«ï¼‰åŠä¹‹å‰6å¤©ï¼Œå…±7å¤©çš„æ•°æ®ã€‚
*   **æ ¸å¿ƒåŠŸèƒ½**: è·å–ä¸€ä¸ªè¿ç»­7å¤©çš„ç¡çœ æ—¶é•¿åˆ—è¡¨ï¼Œä¸»è¦ç”¨äºå‰ç«¯æ¸²æŸ“å¯è§†åŒ–å›¾è¡¨ï¼Œå¦‚æŸ±çŠ¶å›¾ã€‚æ­¤APIç»è¿‡æ—¶åŒºä¼˜åŒ–ï¼Œèƒ½å¯é åœ°å¤„ç†è·¨å¤©è®°å½•ã€‚
*   **Success Response (`200 OK`)**:
    
    ```json
    {
        "status": "success",
        "message": "è·å– 2023-10-21 åˆ° 2023-10-27 çš„ç¡çœ æ•°æ®æˆåŠŸ",
        "data": [
            {
                "date": "2023-10-21",
                "duration_hours": 0
            },
            {
                "date": "2023-10-22",
                "duration_hours": 7.5
            },
            {
                "date": "2023-10-23",
                "duration_hours": 8.1
            },
            {
                "date": "2023-10-24",
                "duration_hours": 6.8
            },
            {
                "date": "2023-10-25",
                "duration_hours": 0
            },
            {
                "date": "2023-10-26",
                "duration_hours": 7.2
            },
            {
                "date": "2023-10-27",
                "duration_hours": 7.9
            }
        ]
    }
    ```
*   **å­—æ®µè¯´æ˜**:
    *   `data`: ä¸€ä¸ªåŒ…å«7ä¸ªå¯¹è±¡çš„æ•°ç»„ï¼Œä»£è¡¨ä» `end_date_str` å€’æ¨çš„è¿ç»­7å¤©ã€‚
    *   `data.date`: æ—¥æœŸå­—ç¬¦ä¸² (`YYYY-MM-DD`)ã€‚
    *   `data.duration_hours`: è¯¥æ—¥çš„ç¡çœ æ—¶é•¿ï¼ˆå•ä½ï¼šå°æ—¶ï¼‰ã€‚**å¦‚æœå½“å¤©æ²¡æœ‰è®°å½•ï¼Œåˆ™ä¸º `0`**ï¼Œç¡®ä¿å‰ç«¯å¯ä»¥ç¨³å®šæ¸²æŸ“ã€‚
*   **Error Response (`400 Bad Request`)**:
    ```json
    {
        "status": "error",
        "message": "æ—¥æœŸæ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨ YYYY-MM-DD"
    }
    ```
    *   å½“ `end_date_str` æ ¼å¼ä¸æ­£ç¡®æ—¶è¿”å›ã€‚
    
### **12. å‘¨æœŸæ€§ç»¼åˆå¥åº·æŠ¥å‘Š (Periodic Health Report)**

*   **URL**: `/api/reports/health-summary/`
*   **Method**: `GET`
*   **Authentication**: éœ€è¦ (Authentication Required)
*   **URL å‚æ•°**: æ— 
*   **Query Parameters**:
    *   `start_date` - **å¿…éœ€**ã€‚æŠ¥å‘Šå‘¨æœŸçš„å¼€å§‹æ—¥æœŸï¼Œæ ¼å¼ä¸º `YYYY-MM-DD`ã€‚
    *   `end_date` - **å¿…éœ€**ã€‚æŠ¥å‘Šå‘¨æœŸçš„ç»“æŸæ—¥æœŸï¼Œæ ¼å¼ä¸º `YYYY-MM-DD`ã€‚
*   **æ ¸å¿ƒåŠŸèƒ½**: ç”Ÿæˆä¸€ä¸ªæŒ‡å®šæ—¶é—´å‘¨æœŸå†…çš„ã€é«˜åº¦è¯¦ç»†çš„å¥åº·åˆ†ææŠ¥å‘Šã€‚æŠ¥å‘Šä¼šå¯¹ç¡çœ ã€è¿åŠ¨ã€é¥®é£Ÿä¸‰ä¸ªç»´åº¦è¿›è¡Œç‹¬ç«‹è¯„åˆ†å’Œæ·±åº¦åˆ†æï¼Œå¹¶æœ€ç»ˆç»™å‡ºä¸€ä¸ªç»¼åˆè¯„åˆ†ã€çƒ­é‡å¹³è¡¡åˆ†æå’Œæ™ºèƒ½åŒ–çš„ä¼˜å…ˆæ”¹è¿›å»ºè®®ã€‚
*   **Success Response (`200 OK`)**:
    ```json
    {
        "status": "success",
        "report": {
            "period": {
                "start_date": "2023-10-20",
                "end_date": "2023-10-26",
                "total_days": 7
            },
            "overall_summary": {
                "title": "åŸºæœ¬å‡è¡¡ï¼Œä½†æœ‰æå‡ç©ºé—´",
                "overall_score": 72,
                "calorie_balance": {
                    "average_intake": 2057,
                    "average_activity_burn": 250,
                    "estimated_bmr": 1800,
                    "net_calories": 7,
                    "comment": "çƒ­é‡åŸºæœ¬å¹³è¡¡"
                },
                "priority_suggestions": [
                    "æœ¬å‘¨æœŸæ‚¨éœ€è¦åœ¨â€œé¥®é£Ÿâ€æ–¹é¢æŠ•å…¥æ›´å¤šå…³æ³¨ã€‚",
                    "æ—¥å‡çƒ­é‡æ‘„å…¥ 2057 å¤§å¡ï¼Œå¯èƒ½åé«˜ã€‚è¯·å…³æ³¨é«˜çƒ­é‡é£Ÿç‰©çš„æ‘„å…¥ã€‚",
                    "æ™šé¤çƒ­é‡å æ¯”è¾ƒé«˜ï¼Œå»ºè®®å°†æ›´å¤šçƒ­é‡åˆ†é…åˆ°æ—©é¤å’Œåˆé¤ã€‚"
                ]
            },
            "sleep_analysis": {
                "score": 82,
                "suggestions": [ "...", "..." ],
                "record_count": 7,
                "average_duration_hours": 7.6,
                "consistency": {
                    "sleep_time_std_dev_minutes": 55,
                    "wakeup_time_std_dev_minutes": 48,
                    "comment": "ä½œæ¯è§„å¾‹æ€§ä¸€èˆ¬"
                },
                "extremes": {
                    "shortest_sleep_hours": 6.5,
                    "longest_sleep_hours": 8.9
                },
                "data_coverage_percent": 100
            },
            "sports_analysis": {
                "score": 70,
                "suggestions": [ "..." ],
                "record_count": 4,
                "total_duration_minutes": 120,
                "total_calories_burned": 1750,
                "frequency_per_week": 4.0,
                "most_frequent_activity": "è·‘æ­¥",
                "data_coverage_percent": 57
            },
            "diet_analysis": {
                "score": 60,
                "suggestions": [ "...", "..." ],
                "average_daily_calories": 2057,
                "calorie_distribution": {
                    "breakfast": 3500,
                    "lunch": 5200,
                    "dinner": 5700,
                    "snack": 0
                },
                "data_coverage_percent": 100
            }
        }
    }
    ```
*   **å­—æ®µè¯´æ˜**:
    *   `report.period`: æŠ¥å‘Šè¦†ç›–çš„å‘¨æœŸä¿¡æ¯ã€‚
        *   `total_days`: å‘¨æœŸå†…çš„æ€»å¤©æ•°ã€‚
    *   `report.overall_summary`: æŠ¥å‘Šçš„æ•´ä½“æ‘˜è¦ã€‚
        *   `title`: åŸºäºæ€»åˆ†çš„æŠ¥å‘Šæ ‡é¢˜ï¼Œå¦‚ "ä¼˜ç§€ï¼å¥åº·ç”Ÿæ´»æ–¹å¼çš„å…¸èŒƒ"ã€‚
        *   `overall_score`: ç»¼åˆå¥åº·å¾—åˆ† (0-100)ï¼Œç”±å„åˆ†é¡¹åŠ æƒè®¡ç®—ã€‚
        *   `calorie_balance`: çƒ­é‡å¹³è¡¡åˆ†æã€‚
            *   `average_intake`: å‘¨æœŸå†…æ—¥å‡æ‘„å…¥çƒ­é‡ (å¤§å¡)ã€‚
            *   `average_activity_burn`: å‘¨æœŸå†…æ—¥å‡è¿åŠ¨æ¶ˆè€—çƒ­é‡ (å¤§å¡)ã€‚
            *   `estimated_bmr`: ä¼°ç®—çš„åŸºç¡€ä»£è°¢ç‡ (å¤§å¡)ã€‚
            *   `net_calories`: å‡€çƒ­é‡å·®å€¼ (`æ‘„å…¥ - è¿åŠ¨æ¶ˆè€— - åŸºç¡€ä»£è°¢`)ã€‚
            *   `comment`: åŸºäº `net_calories` çš„ä¸€ä¸ªç®€çŸ­è¯„ä»·ï¼Œå¦‚ "çƒ­é‡ç›ˆä½™" æˆ– "çƒ­é‡äºæŸ"ã€‚
        *   `priority_suggestions`: ä¸€ä¸ªå»ºè®®æ•°ç»„ï¼Œ**ä¼˜å…ˆå±•ç¤ºå¾—åˆ†æœ€ä½ç»´åº¦çš„å»ºè®®**ï¼Œå¸®åŠ©ç”¨æˆ·èšç„¦æ ¸å¿ƒé—®é¢˜ã€‚
    *   `report.sleep_analysis`: ç¡çœ ç»´åº¦çš„è¯¦ç»†åˆ†æã€‚
        *   `score`: ç¡çœ å¥åº·å¾—åˆ† (0-100)ã€‚
        *   `suggestions`: é’ˆå¯¹ç¡çœ çš„å»ºè®®åˆ—è¡¨ã€‚
        *   `record_count`: å‘¨æœŸå†…ç¡çœ è®°å½•çš„æ€»æ¡æ•°ã€‚
        *   `average_duration_hours`: å¹³å‡ç¡çœ æ—¶é•¿ (å°æ—¶)ã€‚
        *   `consistency`: ç¡çœ è§„å¾‹æ€§åˆ†æã€‚
            *   `sleep_time_std_dev_minutes`: å…¥ç¡æ—¶é—´çš„æ ‡å‡†å·® (åˆ†é’Ÿ)ï¼Œå€¼è¶Šå°è¶Šè§„å¾‹ã€‚
            *   `wakeup_time_std_dev_minutes`: èµ·åºŠæ—¶é—´çš„æ ‡å‡†å·® (åˆ†é’Ÿ)ã€‚
            *   `comment`: åŸºäºæ ‡å‡†å·®çš„è§„å¾‹æ€§è¯„ä»·ï¼Œå¦‚ "ä½œæ¯éå¸¸è§„å¾‹"ã€‚
        *   `extremes`: æå€¼æ•°æ®ã€‚
            *   `shortest_sleep_hours`: æœ€çŸ­ä¸€æ¬¡ç¡çœ çš„æ—¶é•¿ã€‚
            *   `longest_sleep_hours`: æœ€é•¿ä¸€æ¬¡ç¡çœ çš„æ—¶é•¿ã€‚
        *   `data_coverage_percent`: æ•°æ®è®°å½•è¦†ç›–ç‡ï¼Œå³æœ‰ç¡çœ è®°å½•çš„å¤©æ•°å æ€»å¤©æ•°çš„ç™¾åˆ†æ¯”ã€‚
    *   `report.sports_analysis`: è¿åŠ¨ç»´åº¦çš„è¯¦ç»†åˆ†æã€‚
        *   `score`: è¿åŠ¨å¥åº·å¾—åˆ† (0-100)ã€‚
        *   `total_duration_minutes`: å‘¨æœŸå†…æ€»è¿åŠ¨æ—¶é•¿ (åˆ†é’Ÿ)ã€‚
        *   `total_calories_burned`: å‘¨æœŸå†…æ€»æ¶ˆè€—çƒ­é‡ (å¤§å¡)ã€‚
        *   `frequency_per_week`: æ¯å‘¨ç­‰æ•ˆè¿åŠ¨æ¬¡æ•°ã€‚
        *   `most_frequent_activity`: å‘¨æœŸå†…æœ€å¸¸è¿›è¡Œçš„è¿åŠ¨ç±»å‹ã€‚
    *   `report.diet_analysis`: é¥®é£Ÿç»´åº¦çš„è¯¦ç»†åˆ†æã€‚
        *   `score`: é¥®é£Ÿå¥åº·å¾—åˆ† (0-100)ã€‚
        *   `average_daily_calories`: æ—¥å‡æ‘„å…¥çƒ­é‡ (å¤§å¡)ã€‚
        *   `calorie_distribution`: å‘¨æœŸå†…æ€»çƒ­é‡çš„é¤æ¬¡åˆ†å¸ƒæƒ…å†µ (å¤§å¡)ã€‚
*   **Error Responses (`400 Bad Request`)**:
    *   å½“ `start_date` æˆ– `end_date` ç¼ºå¤±æ—¶:
        ```json
        { "status": "error", "message": "å¿…é¡»æä¾› start_date å’Œ end_date æŸ¥è¯¢å‚æ•°" }
        ```
    *   å½“æ—¥æœŸæ ¼å¼ä¸æ­£ç¡®æ—¶:
        ```json
        { "status": "error", "message": "æ—¥æœŸæ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨ YYYY-MM-DD" }
        ```
    *   å½“ `start_date` åœ¨ `end_date` ä¹‹åæ—¶:
        ```json
        { "status": "error", "message": "å¼€å§‹æ—¥æœŸä¸èƒ½æ™šäºç»“æŸæ—¥æœŸ" }
        ```

### **13. å¥åº·å¼‚å¸¸é¢„è­¦ (Health Alerts)**

- **Endpoint**: /api/alerts/check/

- **Method**: GET

- **æ ¸å¿ƒåŠŸèƒ½**: æ£€æŸ¥ç”¨æˆ·è¿‘æœŸçš„å¥åº·æ•°æ®ï¼Œè¯†åˆ«æ˜¯å¦å­˜åœ¨è¿ç»­å¤šå¤©çš„è´Ÿé¢è¶‹åŠ¿ï¼ˆå¦‚è¿ç»­ç¡çœ ä¸è¶³ã€è¿ç»­è¿åŠ¨é‡è¿‡ä½ï¼‰ã€‚æ­¤æ¥å£è®¾è®¡ä¸ºè½»é‡çº§ï¼Œé€‚åˆåœ¨åº”ç”¨å¯åŠ¨æˆ–è¿›å…¥ä¸»é¡µæ—¶è°ƒç”¨ï¼Œä»¥å†³å®šæ˜¯å¦éœ€è¦å‘ç”¨æˆ·å¼¹å‡ºæé†’ã€‚

- **Success Response (200 OK)**:

  - å“åº”ä½“æ˜¯ä¸€ä¸ª**æ•°ç»„**ï¼ŒåŒ…å«æ‰€æœ‰å½“å‰è§¦å‘çš„é¢„è­¦å¯¹è±¡ã€‚
  - **å¦‚æœæ²¡æœ‰ä»»ä½•é¢„è­¦ï¼Œå°†è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ []ã€‚**

- **å“åº” Body (ç¤ºä¾‹ï¼šå½“æ‰€æœ‰é¢„è­¦éƒ½è§¦å‘æ—¶)**:

  ```json
  [
      {
          "alert_code": "POOR_SLEEP_STREAK",
          "message": "æ‚¨å·²è¿ç»­3å¤©ç¡çœ ä¸è¶³7.0å°æ—¶ï¼Œè¯·æ³¨æ„ä¿è¯å……è¶³çš„ä¼‘æ¯ã€‚"
      },
      {
          "alert_code": "LOW_ACTIVITY_STREAK",
          "message": "æ‚¨å·²è¿ç»­3å¤©è¿åŠ¨é‡è¿‡ä½ï¼Œå»ºè®®å¢åŠ é€‚åº¦é”»ç‚¼æ¥ä¿æŒæ´»åŠ›ã€‚"
      }
  ]
  ```

  - **å­—æ®µè¯´æ˜**:
    - alert_code: é¢„è­¦çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å‰ç«¯å¯ä»¥æ ¹æ®æ­¤ä»£ç æ‰§è¡Œç‰¹å®šé€»è¾‘ï¼Œä¾‹å¦‚æ˜¾ç¤ºä¸åŒçš„å›¾æ ‡æˆ–æ ·å¼ã€‚
    - message: å‡†å¤‡å¥½çš„ã€å¯ä»¥ç›´æ¥æ˜¾ç¤ºç»™ç”¨æˆ·çš„é¢„è­¦æ–‡æœ¬ã€‚

- **å“åº” Body (ç¤ºä¾‹ï¼šå½“æ²¡æœ‰é¢„è­¦æ—¶)**:

  ```json
  []
  ```

### **14. åŠ¨æ€æ™ºèƒ½é¥®é£Ÿæ¨è (Smart Diet Recommendation)**

- **URL**: /api/recommendations/diet/

- **Method**: GET

- **Authentication**: éœ€è¦ (Authentication Required)

- **Query Parameters**:

  - date - **å¿…éœ€**ã€‚æŸ¥è¯¢çš„æ—¥æœŸï¼Œæ ¼å¼ä¸º YYYY-MM-DDã€‚
  - meal_type - **å¿…éœ€**ã€‚è¦æ¨èçš„é¤æ¬¡ç±»å‹ï¼Œå¯é€‰å€¼ä¸º breakfast, lunch, dinner, snackã€‚

- **æ ¸å¿ƒåŠŸèƒ½**:
  è¿™æ˜¯ç³»ç»Ÿæœ€æ™ºèƒ½çš„APIä¹‹ä¸€ã€‚å®ƒä¼š**ç»¼åˆåˆ†æç”¨æˆ·å½“æ—¥çš„è¿åŠ¨æƒ…å†µ**ï¼ŒåŠ¨æ€è®¡ç®—å‡ºä¸ªæ€§åŒ–çš„æ€»çƒ­é‡éœ€æ±‚å’Œå®é‡è¥å…»ç´ ï¼ˆè›‹ç™½è´¨ã€ç¢³æ°´ã€è„‚è‚ªï¼‰é…æ¯”ã€‚éšåï¼Œç®—æ³•ä¼šæ¨¡æ‹Ÿè¥å…»å¸ˆçš„é…é¤æ€è·¯ï¼Œ**ä¼˜å…ˆä¿è¯è¤ç´ æ­é…å’Œå¥—é¤ç»“æ„çš„åˆç†æ€§**ï¼Œä»æœ¬åœ°é«˜è´¨é‡çš„é£Ÿç‰©åº“ä¸­æ„å»ºå‡ºå¤šç»„æ—¢è¥å…»å‡è¡¡åˆç¬¦åˆé¥®é£Ÿä¹ æƒ¯çš„æ¨èå¥—é¤ã€‚

- **Success Response (200 OK)**:

  ```json
  {
      "status": "success",
      "message": "æ ¹æ®æ‚¨ä»Šå¤©çš„è¿åŠ¨æƒ…å†µï¼Œä¸ºæ‚¨ç”Ÿæˆäº†lunchçš„è¥å…»æ¨è",
      "recommendation_context": {
          "dynamic_target_calories": 2250,
          "bmr_estimated": 1800,
          "calories_burned_from_sport": 450,
          "calories_eaten_today": 500,
          "target_meal_calories": 700,
          "target_macros_grams": {
              "protein": 70,
              "carbs": 70,
              "fat": 16
          },
          "used_macro_ratios": {
              "carbs": 0.4,
              "protein": 0.4,
              "fat": 0.2
          }
      },
      "recommendations": [
          {
              "title": "æ™ºèƒ½è¥å…»å¥—é¤",
              "total_calories": 695,
              "total_macros": {
                  "protein": 68.5,
                  "fat": 15.2,
                  "carbs": 69.0
              },
              "items": [
                  {
                      "food_id": 15,
                      "name": "ç‰›è‚‰ï¼ˆåè…¿ï¼‰",
                      "portion_g": 200,
                      "calories": 212,
                      "macros": { "protein": 41.8, "fat": 4.0, "carbs": 2.2 }
                  },
                  {
                      "food_id": 22,
                      "name": "ç³™ç±³é¥­",
                      "portion_g": 150,
                      "calories": 167,
                      "macros": { "protein": 4.1, "fat": 1.2, "carbs": 34.8 }
                  },
                  {
                      "food_id": 31,
                      "name": "è¥¿å…°èŠ±",
                      "portion_g": 200,
                      "calories": 68,
                      "macros": { "protein": 5.8, "fat": 0.8, "carbs": 13.2 }
                  }
              ]
          }
      ]
  }
  ```

- **å­—æ®µè¯´æ˜**:

  - recommendation_context: æä¾›äº†æœ¬æ¬¡æ¨èçš„è®¡ç®—ä¾æ®ï¼Œéå¸¸é€‚åˆè°ƒè¯•å’Œå±•ç¤ºã€‚
    - dynamic_target_calories: **åŠ¨æ€è®¡ç®—**çš„å½“æ—¥æ€»çƒ­é‡ç›®æ ‡ (BMR + è¿åŠ¨æ¶ˆè€—)ã€‚
    - calories_burned_from_sport: å½“æ—¥è¿åŠ¨æ¶ˆè€—çš„çƒ­é‡ã€‚
    - target_macros_grams: **æœ¬é¤çš„å®é‡è¥å…»ç´ ç›®æ ‡ï¼ˆå…‹ï¼‰**ã€‚
    - used_macro_ratios: **æ ¹æ®è¿åŠ¨ç±»å‹åŠ¨æ€é€‰æ‹©çš„è¥å…»ç´ é…æ¯”**ï¼ˆä¾‹å¦‚ï¼ŒåŠ›é‡è®­ç»ƒåä¼šä½¿ç”¨é«˜è›‹ç™½é…æ¯”ï¼‰ã€‚
  - recommendations: ä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨èå¥—é¤çš„æ•°ç»„ã€‚
    - total_macros: è¯¥å¥—é¤å®é™…åŒ…å«çš„æ€»å®é‡è¥å…»ç´ ã€‚
    - items: ç»„æˆå¥—é¤çš„é£Ÿç‰©åˆ—è¡¨ï¼Œ**ç°åœ¨æ¯ä¸ªé£Ÿç‰©æ¡ç›®ä¹ŸåŒ…å«äº†ç‹¬ç«‹çš„å®é‡è¥å…»ç´ ä¿¡æ¯ macros**ã€‚

- **ç‰¹æ®Šæƒ…å†µå“åº” (Info)**:

  - å½“ç”¨æˆ·å½“å¤©çƒ­é‡æ‘„å…¥å·²åŸºæœ¬è¾¾æ ‡æ—¶:

  ```json
  {
      "status": "info",
      "message": "ä»Šæ—¥çƒ­é‡å·²åŸºæœ¬è¾¾æ ‡",
      "recommendations": []
  }
  ```

- **Error Responses**:

  - 400 Bad Request: å½“ date æˆ– meal_type å‚æ•°ç¼ºå¤±æˆ–æ— æ•ˆæ—¶ã€‚
  - 500 Internal Server Error: å½“æœ¬åœ°é£Ÿç‰©åº“æ•°æ®ä¸è¶³ï¼Œæ— æ³•æ„å»ºåˆç†å¥—é¤æ—¶ã€‚

### **15. å¥½å‹ä¸ç¤¾äº¤åŠŸèƒ½ (Friends & Social)**

#### **15.1 å¥½å‹å…³ç³» (Friendship)**

*   **Endpoint**: `/api/friendships/`
*   **æ ¸å¿ƒ**: ç®¡ç†ç”¨æˆ·çš„å¥½å‹å…³ç³»ï¼ŒåŒ…æ‹¬è¯·æ±‚çš„å‘é€ã€æ¥å—ã€æ‹’ç»ä»¥åŠåŠ¨æ€æŸ¥çœ‹æƒé™çš„è®¾ç½®ã€‚

| æ“ä½œ               | Method   | URL                                     | è¯´æ˜                                           |
| :----------------- | :------- | :-------------------------------------- | :--------------------------------------------- |
| **è·å–å…³ç³»åˆ—è¡¨**   | `GET`    | `/api/friendships/`                     | è·å–ä¸æˆ‘ç›¸å…³çš„æ‰€æœ‰å…³ç³»ï¼ˆæˆ‘å‘å‡ºçš„æˆ–æˆ‘æ”¶åˆ°çš„ï¼‰ã€‚ |
| **å‘é€å¥½å‹è¯·æ±‚**   | `POST`   | `/api/friendships/`                     | å‘å¦ä¸€ä¸ªç”¨æˆ·å‘é€å¥½å‹è¯·æ±‚ã€‚                     |
| **æ¥å—å¥½å‹è¯·æ±‚**   | `PUT`    | `/api/friendships/{id}/accept/`         | æ¥å—æ”¶åˆ°çš„å¥½å‹è¯·æ±‚ã€‚                           |
| **æ‹’ç»/å–æ¶ˆ/åˆ é™¤** | `DELETE` | `/api/friendships/{id}/`                | åˆ é™¤å¥½å‹å…³ç³»ï¼Œæˆ–å–æ¶ˆ/æ‹’ç»ä¸€ä¸ªå¾…å¤„ç†çš„è¯·æ±‚ã€‚    |
| **è®¾ç½®åŠ¨æ€æƒé™**   | `PUT`    | `/api/friendships/{id}/set-permission/` | **æˆæƒæˆ–å–æ¶ˆ**å¥½å‹æŸ¥çœ‹æˆ‘åŠ¨æ€çš„æƒé™ã€‚           |

* **è·å–å…³ç³»åˆ—è¡¨ (`GET`) çš„ç­›é€‰åŠŸèƒ½**:

  *   è·å–å¾…å¤„ç†çš„å¥½å‹è¯·æ±‚: `GET /api/friendships/?status=pending`
  *   è·å–å·²æ¥å—çš„å¥½å‹åˆ—è¡¨: `GET /api/friendships/?status=accepted`

* **å‘é€è¯·æ±‚ (`POST`) Request Body**:

  ```json
  {
      "to_user": 2 // ç›®æ ‡ç”¨æˆ·çš„ID
  }
  ```

* **è®¾ç½®æƒé™ (`PUT /set-permission/`) Request Body**:

  ```json
  {
      "can_view": false // `false`ä¸ºç¦æ­¢å¥½å‹æŸ¥çœ‹æˆ‘çš„åŠ¨æ€, `true`ä¸ºå…è®¸
  }
  ```

* **å“åº” Body (ç¤ºä¾‹)**:

  ```json
  {
      "id": 1,
      "from_user_info": { "username": "user_a", ... },
      "to_user_info": { "username": "user_b", ... },
      "status": "accepted",
      "from_user_can_be_viewed": true, // user_a æ˜¯å¦æˆæƒ user_b æŸ¥çœ‹
      "to_user_can_be_viewed": false   // user_b æ˜¯å¦æˆæƒ user_a æŸ¥çœ‹
  }
  ```

#### **15.2 å¥½å‹åŠ¨æ€ä¿¡æ¯æµ (Health Feed)**

* **URL**: `/api/feed/`

* **Method**: `GET`

* **æ ¸å¿ƒ**: è·å–ä¸€ä¸ªæŒ‰æ—¶é—´å€’åºæ’åˆ—çš„ä¿¡æ¯æµï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰**å·²æˆæƒ**çš„å¥½å‹æœ€è¿‘7å¤©å‘å¸ƒçš„å¥åº·åŠ¨æ€ã€‚

* **Success Response (`200 OK`)**:

  ```json
  [
      {
          "type": "sleep",
          "user": { "id": 2, "username": "friend_a" },
          "timestamp": "2025-08-01T07:30:00Z",
          "content": "ç¡äº† 8.5 å°æ—¶ã€‚",
          "content_type_model": "sleeprecord",
          "object_id": 101
      },
      {
          "type": "sport",
          "user": { "id": 3, "username": "friend_b" },
          "timestamp": "2025-07-31T00:00:00Z",
          "content": "è¿›è¡Œäº† 45 åˆ†é’Ÿçš„ æ¸¸æ³³ è¿åŠ¨ï¼Œæ¶ˆè€—äº† 400 å¤§å¡ã€‚",
          "content_type_model": "sportrecord",
          "object_id": 205
      }
  ]
  ```

#### **15.3 è¯„è®º (Comment)**

*   **Endpoint**: `/api/comments/`
*   **æ ¸å¿ƒ**: å¯¹è‡ªå·±æˆ–**å·²æˆæƒ**å¥½å‹çš„åŠ¨æ€è¿›è¡Œè¯„è®ºã€‚

| æ“ä½œ             | Method   | URL                   | è¯´æ˜                                                 |
| :--------------- | :------- | :-------------------- | :--------------------------------------------------- |
| **è·å–è¯„è®ºåˆ—è¡¨** | `GET`    | `/api/comments/`      | è·å–æŸæ¡ç‰¹å®šåŠ¨æ€ä¸‹çš„æ‰€æœ‰è¯„è®ºã€‚**å¿…é¡»æä¾›æŸ¥è¯¢å‚æ•°**ã€‚ |
| **å‘è¡¨è¯„è®º**     | `POST`   | `/api/comments/`      | å¯¹æŸæ¡åŠ¨æ€å‘è¡¨ä¸€æ¡æ–°è¯„è®ºã€‚                           |
| **åˆ é™¤æˆ‘çš„è¯„è®º** | `DELETE` | `/api/comments/{id}/` | åˆ é™¤è‡ªå·±å‘è¡¨çš„è¯„è®ºã€‚                                 |

* **è·å–åˆ—è¡¨ (`GET`) Query Parameters**: (å¿…éœ€)

  *   `content_type_model`: è¢«è¯„è®ºåŠ¨æ€çš„ç±»å‹ (å¦‚ `sleeprecord`, `sportrecord`, `meal`)
  *   `object_id`: è¢«è¯„è®ºåŠ¨æ€çš„ID
  *   **ç¤ºä¾‹**: `GET /api/comments/?content_type_model=sleeprecord&object_id=101`

* **å‘è¡¨è¯„è®º (`POST`) Request Body**:

  ```json
  {
      "content_type_model": "sleeprecord",
      "object_id": 101,
      "text": "æ˜¨æ™šç¡å¾—çœŸä¸é”™ï¼"
  }
  ```

* **å“åº” Body (ç¤ºä¾‹)**:

  ```json
  {
      "id": 5,
      "author_username": "your_username",
      "text": "æ˜¨æ™šç¡å¾—çœŸä¸é”™ï¼",
      "created_at": "2025-08-01T09:00:00Z"
  }
  ```
---

## å½“å‰ï¼ˆå¿…åšé˜¶æ®µï¼‰å¼€å‘ä»»åŠ¡

**å‰ç«¯ï¼š**

1.  ä¸ºç”¨æˆ·è®¾å®šä¸ªäººå¥åº·ç›®æ ‡æä¾›å‰ç«¯æ”¯æŒï¼Œåœ¨ä¸»çœ‹æ¿ä¸­å±•ç¤ºç›®æ ‡å®Œæˆè¿›åº¦ã€‚ 
2.  å½“ç”¨æˆ·è¿ç»­å¤šå¤©ç¡çœ ä¸è¶³æˆ–è¿åŠ¨é‡è¿‡ä½æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨å¼¹å‡ºæé†’ã€‚ 
3.  è°ƒç”¨åç«¯APIæ¥å£ï¼Œå±•ç¤ºæ™ºèƒ½æ¨èçš„é¥®é£Ÿå¥—é¤ã€‚

**åç«¯ï¼š**

1. ä¸ºå¥½å‹åŠŸèƒ½æä¾›APIæ”¯æŒã€‚

---

## åä½œè§„èŒƒ

1.  **åˆ†æ”¯ç®¡ç†**:
    *   `main` åˆ†æ”¯æ˜¯å—ä¿æŠ¤çš„ç¨³å®šåˆ†æ”¯ã€‚
    *   æ‰€æœ‰å¼€å‘å·¥ä½œè¯·**åˆ›å»ºæ–°çš„ç‰¹æ€§åˆ†æ”¯**ï¼Œå‘½åè§„åˆ™ï¼š`feature/xxx` (ä¾‹å¦‚ `feature/login-page` æˆ– `feature/sleep-api`)ã€‚
    *   å®Œæˆå¼€å‘åï¼Œé€šè¿‡ `Pull Request` (PR) åˆå¹¶åˆ° `main` åˆ†æ”¯ã€‚

2.  **ä»£ç æäº¤**:
    *   æäº¤ä»£ç å‰ï¼Œè¯·ç¡®ä¿åœ¨æœ¬åœ°æµ‹è¯•é€šè¿‡ã€‚
    *   Commit Messageåº”æ¸…æ™°æ˜äº†ï¼Œæè¿°æœ¬æ¬¡æäº¤çš„ä¸»è¦å†…å®¹ï¼Œä¾‹å¦‚ `Feat: Implement user login API` æˆ– `Fix: Correct sleep duration calculation`ã€‚